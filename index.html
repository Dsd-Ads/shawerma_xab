<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö—Ä–∞—Ñ—Ç –•–∞–± ‚Äî –ú–µ–Ω—é</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #248bed);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
        }

        body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; }
        
        header { position: sticky; top: 0; background: var(--bg-color); z-index: 10; padding: 10px; border-bottom: 0.5px solid #eee; text-align: center; font-weight: bold; }
        
        .nav-tabs { display: flex; overflow-x: auto; padding: 10px; gap: 8px; position: sticky; top: 41px; background: var(--bg-color); z-index: 9; border-bottom: 0.5px solid #eee; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-btn { padding: 6px 15px; background: var(--secondary-bg); border-radius: 15px; font-size: 13px; white-space: nowrap; border: none; color: inherit; }
        .nav-btn.active { background: var(--button-color); color: var(--button-text); }

        .order-settings { background: var(--secondary-bg); margin: 12px; padding: 12px; border-radius: 12px; }
        .setting-item { margin-bottom: 10px; }
        .label { font-size: 11px; color: var(--hint-color); text-transform: uppercase; margin-bottom: 4px; font-weight: 600; }
        select, textarea { 
            width: 100%; background: var(--bg-color); border: 0.5px solid rgba(0,0,0,0.1); 
            border-radius: 8px; padding: 8px; font-size: 14px; color: var(--text-color); outline: none; box-sizing: border-box;
        }
        textarea { resize: none; height: 60px; font-family: inherit; }

        .item-card { display: flex; padding: 15px; border-bottom: 0.5px solid #f0f0f0; gap: 12px; align-items: center; position: relative; }
        .img-wrapper { position: relative; flex-shrink: 0; }
        .item-img { width: 85px; height: 85px; border-radius: 12px; object-fit: cover; background: #f5f5f5; }
        
        /* –°—Ç–∏–ª—å —Å—á–µ—Ç—á–∏–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ */
        .badge {
            position: absolute; top: -5px; right: -5px;
            background: #e64d44; color: white;
            font-size: 12px; font-weight: bold;
            min-width: 20px; height: 20px;
            border-radius: 10px; display: none;
            align-items: center; justify-content: center;
            border: 2px solid var(--bg-color);
        }

        .item-info { flex: 1; }
        .item-title { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .item-desc { font-size: 12px; color: var(--hint-color); line-height: 1.2; }
        .item-price { font-weight: 700; color: var(--text-color); margin-top: 8px; }

        .add-btn { background: var(--button-color); color: var(--button-text); border: none; padding: 8px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; }

        #modal-overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: flex-end; }
        #modal { background: var(--bg-color); width: 100%; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; max-height: 85vh; overflow-y: auto; }
        .mod-section-title { font-size: 13px; font-weight: bold; color: var(--hint-color); margin: 15px 0 8px; text-transform: uppercase; }
        .modifier-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; align-items: center; }
        .modifier-item input { width: 22px; height: 22px; accent-color: var(--button-color); }
        .category-title { padding: 15px 15px 5px; font-weight: bold; color: var(--hint-color); text-transform: uppercase; font-size: 12px; }
        .bottom-space { height: 120px; }
    </style>
</head>
<body>

<header>–ö–†–ê–§–¢ –•–ê–ë</header>
<div class="nav-tabs" id="nav-tabs"></div>

<div class="order-settings">
    <div class="setting-item">
        <div class="label">–í—Ä–µ–º—è –ø–æ–¥–∞—á–∏</div>
        <select id="order-time">
            <option value="üöÄ –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ">–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</option>
        </select>
    </div>
    <div class="setting-item">
        <div class="label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</div>
        <textarea id="order-comment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –±–µ–∑ –ª—É–∫–∞, —Å–æ—É—Å –æ—Ç–¥–µ–ª—å–Ω–æ..."></textarea>
    </div>
</div>

<div id="menu-container"></div>
<div class="bottom-space"></div>

<div id="modal-overlay">
    <div id="modal">
        <h3 id="modal-title" style="margin-top:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–ª—é–¥–∞</h3>
        <div id="modifiers-content"></div>
        <button class="add-btn" style="width: 100%; margin-top: 20px; padding: 16px;" onclick="confirmAdd()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑</button>
        <button onclick="closeModal()" style="width: 100%; background: none; border: none; padding: 15px; color: var(--hint-color);">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const modDB = {
        sauces: { title: "–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—É—Å", items: [{ id: "s1", title: "–°—ã—Ä–Ω—ã–π —Å–æ—É—Å", price: 0 }, { id: "s2", title: "–ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å", price: 0 }, { id: "s3", title: "–ë–∞—Ä–±–µ–∫—é", price: 0 }] },
        drinks: { title: "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫", items: [{ id: "d1", title: "–ö–æ–ª–∞ 0.33", price: 0 }, { id: "d2", title: "–°–æ–∫ 0.2", price: 0 }, { id: "d3", title: "–í–æ–¥–∞ 0.5", price: 0 }] },
        sh_extra: { title: "–î–æ–±–∞–≤–∫–∏", items: [{ id: "e1", title: "–°—ã—Ä", price: 40 }, { id: "e2", title: "–•–∞–ª–∞–ø–µ–Ω—å–æ", price: 30 }] }
    };

    const menu = [
        { cat: "üç± –ö–æ–º–±–æ-–æ–±–µ–¥—ã", items: [{ id: "c1", title: "–ö–æ–º–±–æ ‚Ññ1", price: 500, desc: "–•–æ—Ç-–¥–æ–≥, —Ñ—Ä–∏, –Ω–∞–ø–∏—Ç–æ–∫ –∏ —Å–æ—É—Å", img: "https://placehold.co/200x200?text=Combo1", requiredMods: ["drinks", "sauces"] }] },
        { cat: "üåØ –®–∞—É—Ä–º–∞", items: [{ id: "sh1", title: "–®–∞—É—Ä–º–∞ –ö—É—Ä–∏–Ω–∞—è", price: 290, desc: "390–≥. –ö—É—Ä–∏—Ü–∞, –æ–≤–æ—â–∏", img: "https://placehold.co/200x200?text=Shaurma", requiredMods: ["sh_extra"] }] }
    ];

    let cart = [];
    let currentItem = null;

    function renderMenu() {
        const container = document.getElementById('menu-container');
        const nav = document.getElementById('nav-tabs');
        
        menu.forEach((section, idx) => {
            const catId = `cat-${idx}`;
            nav.innerHTML += `<button class="nav-btn ${idx===0?'active':''}" onclick="scrollToCat('${catId}', this)">${section.cat}</button>`;
            container.innerHTML += `<div class="category-title" id="${catId}">${section.cat}</div>`;
            
            section.items.forEach(item => {
                container.innerHTML += `
                    <div class="item-card" data-title="${item.title}">
                        <div class="img-wrapper">
                            <img class="item-img" src="${item.img}">
                            <div class="badge" id="badge-${item.id}">0</div>
                        </div>
                        <div class="item-info">
                            <div class="item-title">${item.title}</div>
                            <div class="item-desc">${item.desc}</div>
                            <div class="item-price">${item.price} ‚ÇΩ</div>
                        </div>
                        <button class="add-btn" onclick="openModal('${item.id}')">Ôºã</button>
                    </div>
                `;
            });
        });
    }

    function updateBadges() {
        // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
        const counts = {};
        cart.forEach(item => {
            counts[item.title] = (counts[item.title] || 0) + 1;
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –±–µ–π–¥–∂–µ–π
        menu.forEach(section => {
            section.items.forEach(item => {
                const b = document.getElementById(`badge-${item.id}`);
                const count = counts[item.title] || 0;
                if (count > 0) {
                    b.innerText = count;
                    b.style.display = 'flex';
                } else {
                    b.style.display = 'none';
                }
            });
        });
    }

    function scrollToCat(id, btn) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function openModal(itemId) {
        let item;
        menu.forEach(c => { const found = c.items.find(i => i.id === itemId); if(found) item = found; });
        currentItem = JSON.parse(JSON.stringify(item));
        const content = document.getElementById('modifiers-content');
        content.innerHTML = '';
        document.getElementById('modal-title').innerText = item.title;

        if (item.requiredMods) {
            item.requiredMods.forEach(modKey => {
                const group = modDB[modKey];
                content.innerHTML += `<div class="mod-section-title">${group.title}</div>`;
                group.items.forEach(m => {
                    const isRadio = (modKey === 'drinks' || modKey === 'sauces');
                    content.innerHTML += `
                        <label class="modifier-item">
                            <span>${m.title} ${m.price > 0 ? '(+' + m.price + ' ‚ÇΩ)' : ''}</span>
                            <input type="${isRadio ? 'radio' : 'checkbox'}" name="${modKey}" data-title="${m.title}" data-price="${m.price}">
                        </label>
                    `;
                });
            });
        }
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function confirmAdd() {
        const selectedMods = [];
        let extraPrice = 0;
        document.querySelectorAll('#modifiers-content input:checked').forEach(input => {
            selectedMods.push(input.dataset.title);
            extraPrice += parseInt(input.dataset.price);
        });

        cart.push({ title: currentItem.title, mods: selectedMods, totalPrice: currentItem.price + extraPrice });
        tg.HapticFeedback.impactOccurred('medium');
        closeModal();
        updateMainButton();
        updateBadges(); // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–µ–π
    }

    function updateMainButton() {
        const total = cart.reduce((sum, i) => sum + i.totalPrice, 0);
        if (total > 0) {
            tg.MainButton.setText(`–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó: ${total} ‚ÇΩ`);
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

    tg.onEvent('mainButtonClicked', () => {
        const payload = {
            items: cart,
            total: cart.reduce((sum, i) => sum + i.totalPrice, 0),
            time: document.getElementById('order-time').value,
            comment: document.getElementById('order-comment').value
        };
        tg.sendData(JSON.stringify(payload));
    });

    renderMenu();
</script>
</body>
</html>
