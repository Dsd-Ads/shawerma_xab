<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ú–µ–Ω—é –®–∞—É—Ä–º–∞ –•–∞–±</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #707579);
            --button-color: var(--tg-theme-button-color, #248bed);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
        }
        header {
            position: sticky; top: 0; z-index: 100;
            background: var(--bg-color);
            padding: 12px; text-align: center; font-weight: 600;
            border-bottom: .5px solid rgba(0,0,0,.1);
        }
        .nav-tabs {
            position: sticky; top: 45px; z-index: 99;
            display: flex; gap: 8px; overflow-x: auto;
            padding: 8px 12px; background: var(--bg-color);
            border-bottom: .5px solid rgba(0,0,0,.1);
        }
        .nav-btn {
            padding: 6px 16px; border-radius: 16px;
            background: var(--secondary-bg);
            text-decoration: none; color: var(--text-color);
            font-size: 14px; white-space: nowrap;
        }
        .nav-btn.active { background: var(--button-color); color: var(--button-text); }
        #app { padding: 12px; padding-bottom: 150px; }
        .category-title {
            font-size: 14px; font-weight: 600; text-transform: uppercase;
            color: var(--hint-color); margin: 20px 4px 8px;
        }
        .item-card {
            background: var(--secondary-bg);
            border-radius: 14px;
            padding: 12px;
            margin-bottom: 10px;
        }
        .item-top { display: flex; gap: 12px; }
        .item-img {
            width: 80px; height: 80px; border-radius: 12px;
            background-size: cover; background-position: center;
            background-color: #ddd; flex-shrink: 0;
        }
        .item-name { font-size: 16px; font-weight: 600; }
        .item-desc { font-size: 13px; color: var(--hint-color); margin-top: 4px; }
        .item-price { font-weight: 700; color: var(--button-color); margin-top: 6px; }
        .controls { display: flex; justify-content: flex-end; margin-top: 10px; }
        .btn-add {
            background: var(--button-color); color: var(--button-text);
            border: none; border-radius: 14px; padding: 6px 18px;
            font-size: 14px; font-weight: 600;
        }
        .instance {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 10px; margin-top: 10px;
        }
        .instance-title {
            font-size: 13px; font-weight: 600; margin-bottom: 6px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .remove-btn { border: none; background: none; color: red; font-size: 14px; }
        .addon-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .addon-item {
            display: flex; gap: 6px; align-items: center;
            font-size: 12px; background: var(--secondary-bg);
            padding: 6px; border-radius: 8px;
        }
        .order-comment {
            position: fixed; bottom: 60px; left: 0; right: 0;
            background: var(--bg-color);
            padding: 10px 12px; border-top: 1px solid rgba(0,0,0,.1);
        }
        .order-comment textarea {
            width: 100%; resize: none; border-radius: 10px; padding: 8px;
            border: 1px solid rgba(0,0,0,.1);
            background: var(--secondary-bg); font-size: 13px;
        }
    </style>
</head>
<body>
<header>–®–∞—É—Ä–º–∞ –•–∞–±</header>
<div class="nav-tabs" id="nav"></div>
<div id="app"><div id="menu"></div></div>
<div class="order-comment"><textarea id="orderComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–æ –≤—Å–µ–º—É –∑–∞–∫–∞–∑—É"></textarea></div>
<script>
const tg = window.Telegram.WebApp;
tg.ready(); tg.expand();

const menuData = [
  { id:'shawarma', name:'üåØ –®–∞—É—Ä–º–∞', items:[
    {id:'sh1', name:'–®–∞—É—Ä–º–∞ –∫—É—Ä–∏—Ü–∞', price:290, desc:'390–≥', img:'https://via.placeholder.com/150?text=Shawarma'},
    {id:'sh2', name:'–®–∞—É—Ä–º–∞ –∫—É—Ä–∏—Ü–∞ –±–æ–ª—å—à–∞—è', price:350, desc:'500–≥', img:'https://via.placeholder.com/150?text=Big'}
  ]}
];
const addons = [
  {n:'üßÄ –°—ã—Ä', p:40}, {n:'üî• –•–∞–ª–∞–ø–µ–Ω—å–æ', p:30}, {n:'ü•í –û–≥—É—Ä–µ—Ü', p:20}
];
let cart = [];

function uid(){ return crypto.randomUUID(); }

function render(){
  const nav=document.getElementById('nav');
  const menu=document.getElementById('menu');
  nav.innerHTML=''; menu.innerHTML='';

  menuData.forEach((cat,i)=>{
    nav.innerHTML+=`<a href="#${cat.id}" class="nav-btn ${i===0?'active':''}" onclick="setActive(this)">${cat.name}</a>`;
    menu.innerHTML+=`<div id="${cat.id}"><div class="category-title">${cat.name}</div></div>`;

    cat.items.forEach(item=>{
      const instances = cart.filter(c=>c.itemId===item.id);
      menu.innerHTML+=`
      <div class="item-card">
        <div class="item-top">
          <div class="item-img" style="background-image:url('${item.img}')"></div>
          <div>
            <div class="item-name">${item.name}</div>
            <div class="item-desc">${item.desc}</div>
            <div class="item-price">${item.price}‚ÇΩ</div>
          </div>
        </div>
        <div class="controls"><button class="btn-add" onclick="addInstance('${item.id}')">–î–æ–±–∞–≤–∏—Ç—å</button></div>
        ${instances.map((inst,i)=>renderInstance(inst,i)).join('')}
      </div>`;
    });
  });
  recalc();
}

function renderInstance(inst,i){
  return `<div class="instance">
    <div class="instance-title">${inst.name} #${i+1}
      <button class="remove-btn" onclick="removeInstance('${inst.uuid}')">‚úï</button>
    </div>
    <div class="addon-grid">
      ${addons.map(a=>`<label class="addon-item">
        <input type="checkbox" ${inst.addons.includes(a.n)?'checked':''}
        onchange="toggleAddon('${inst.uuid}','${a.n}',${a.p})">${a.n} (+${a.p}‚ÇΩ)
      </label>`).join('')}
    </div>
  </div>`;
}

function addInstance(itemId){
  const item = menuData[0].items.find(i=>i.id===itemId);
  cart.push({ uuid:uid(), itemId, name:item.name, base:item.price, addons:[], addonPrice:0 });
  render();
}

function removeInstance(uuid){ cart = cart.filter(i=>i.uuid!==uuid); render(); }

function toggleAddon(uuid,name,price){
  const inst = cart.find(i=>i.uuid===uuid);
  if(!inst) return;
  const idx = inst.addons.indexOf(name);
  if(idx>=0){ inst.addons.splice(idx,1); inst.addonPrice-=price; }
  else { inst.addons.push(name); inst.addonPrice+=price; }
  recalc();
}

function recalc(){
  let total=0;
  cart.forEach(i=> total+= i.base + i.addonPrice);
  if(total>0){ tg.MainButton.setText(`–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó ‚Äî ${total}‚ÇΩ`); tg.MainButton.show(); }
  else tg.MainButton.hide();

  tg.MainButton.onClick(()=>{
    tg.sendData(JSON.stringify({
      items: cart.map(i=>({name:i.name, addons:i.addons, price:i.base+i.addonPrice})),
      comment: document.getElementById('orderComment').value,
      total
    }));
  });
}

function setActive(el){ document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }

render();
</script>
</body>
</html>
