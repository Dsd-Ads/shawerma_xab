<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–∞—É—Ä–º–∞ –•–∞–± ‚Äî –ú–µ–Ω—é</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --link-color: var(--tg-theme-link-color, #248bed);
            --button-color: var(--tg-theme-button-color, #248b91);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0;
            user-select: none; -webkit-tap-highlight-color: transparent; scroll-behavior: smooth;
        }

        header {
            background-color: var(--bg-color); position: sticky; top: 0; z-index: 100;
            padding: 12px; text-align: center; font-weight: 600; border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }

        .nav-tabs {
            display: flex; overflow-x: auto; background-color: var(--bg-color);
            padding: 8px 12px; gap: 8px; position: sticky; top: 45px; z-index: 99;
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }
        .nav-tabs::-webkit-scrollbar { display: none; }

        .nav-btn {
            padding: 6px 16px; background-color: var(--secondary-bg);
            color: var(--text-color); border-radius: 16px;
            font-size: 14px; font-weight: 500; text-decoration: none;
            white-space: nowrap; transition: all 0.2s ease;
        }
        .nav-btn.active { background-color: var(--button-color); color: var(--button-text); }

        .section-anchor { scroll-margin-top: 100px; }

        .category-header {
            padding: 20px 16px 8px; font-size: 14px; font-weight: 600;
            color: var(--hint-color); text-transform: uppercase; letter-spacing: 0.5px;
        }

        .item-card-wrapper { border-bottom: 0.5px solid rgba(0,0,0,0.05); padding: 12px 16px; }
        .item-main { display: flex; gap: 12px; align-items: center; }

        .item-img {
            width: 80px; height: 80px; border-radius: 10px;
            background-color: var(--secondary-bg); background-size: cover; background-position: center; flex-shrink: 0;
        }

        .item-info { flex-grow: 1; }
        .item-title { font-size: 16px; font-weight: 500; margin-bottom: 4px; }
        .item-desc { font-size: 13px; color: var(--hint-color); line-height: 1.2; }

        .item-controls { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; min-width: 80px; }
        .price { font-weight: 600; font-size: 15px; }

        .add-btn {
            background-color: var(--secondary-bg); color: var(--link-color); border: none;
            padding: 5px 15px; border-radius: 14px; font-weight: 600; font-size: 14px; cursor: pointer;
        }

        .counter {
            display: none; align-items: center; background-color: var(--button-color);
            color: var(--button-text); border-radius: 14px; padding: 3px;
        }
        .counter button {
            background: none; border: none; color: var(--button-text);
            font-size: 18px; font-weight: bold; width: 30px; height: 24px; cursor: pointer;
        }
        .count-num { width: 20px; text-align: center; font-weight: 600; }

        .addon-section {
            display: none; margin-top: 12px; padding: 12px;
            background-color: var(--secondary-bg); border-radius: 10px;
        }
        
        .addon-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .addon-item { display: flex; align-items: center; font-size: 13px; background: var(--bg-color); padding: 8px; border-radius: 8px; }
        .addon-item input { margin-right: 8px; width: 16px; height: 16px; accent-color: var(--button-color); }
        
        .comment-label {
            font-size: 12px; color: var(--hint-color); margin-bottom: 6px; display: block;
            text-transform: uppercase; font-weight: 600; margin-top: 8px;
        }

        textarea, select {
            width: 100%; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);
            padding: 8px; font-size: 14px; background: var(--bg-color);
            color: var(--text-color); box-sizing: border-box; outline: none; font-family: inherit;
        }
        select { margin-bottom: 10px; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 8px center; background-size: 16px; }

        .bottom-space { height: 100px; }
    </style>
</head>
<body>

<header>–®–∞—É—Ä–º–∞ –•–∞–±</header>
<div class="nav-tabs" id="nav-tabs"></div>
<div id="menu-list"></div>
<div class="bottom-space"></div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    const categories = {
        'combo': 'üç± –ö–æ–º–±–æ',
        'shawarma': 'üåØ –®–∞—É—Ä–º–∞',
        'hotdogs': 'üå≠ –•–æ—Ç-–¥–æ–≥–∏',
        'snacks': 'üçü –ó–∞–∫—É—Å–∫–∏'
    };

    const menuItems = [
        { 
            id: "combo_1", 
            category: "combo", 
            title: "–ö–æ–º–±–æ ‚Ññ1 (–•–æ—Ç-–¥–æ–≥ + –§—Ä–∏)", 
            price: 490, 
            desc: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ö–æ—Ç-–¥–æ–≥, –ø–æ—Ä—Ü–∏—è —Ñ—Ä–∏, –Ω–∞–ø–∏—Ç–æ–∫ –∏ —Å–æ—É—Å –Ω–∞ –≤—ã–±–æ—Ä", 
            image: "",
            selects: [
                { id: "drink", label: "ü•§ –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫", options: ["–ö–æ–ª–∞", "–°–æ–∫ —è–±–ª–æ–∫–æ", "–ê–π—Ä–∞–Ω", "–í–æ–¥–∞"] },
                { id: "sauce", label: "üçØ –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—É—Å", options: ["–ß–µ—Å–Ω–æ—á–Ω—ã–π", "–°—ã—Ä–Ω—ã–π", "–û—Å—Ç—Ä—ã–π", "–ö–µ—Ç—á—É–ø"] }
            ]
        },
        { id: "sh_kur_st", category: "shawarma", title: "–®–∞—É—Ä–º–∞ –∫—É—Ä–∏—Ü–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)", price: 290, desc: "390–≥. –û–≤–æ—â–∏, —Å–æ—É—Å—ã, –∫–æ—Ä–µ–π—Å–∫–∞—è –º–æ—Ä–∫–æ–≤—å", image: "" },
        { id: "hd_cl", category: "hotdogs", title: "–•–æ—Ç-–¥–æ–≥ –∫–ª–∞—Å—Å–∏–∫", price: 320, desc: "185–≥. –°–æ—Å–∏—Å–∫–∞, —Å—ã—Ä, –æ–≤–æ—â–∏, —Å–æ—É—Å—ã", image: "" },
        { id: "z_fri", category: "snacks", title: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Ñ—Ä–∏", price: 130, desc: "100–≥.", image: "" }
    ];

    const addonsList = [{ n: "üßÄ –°—ã—Ä", p: 40 }, { n: "üî• –•–∞–ª–∞–ø–µ–Ω—å–æ", p: 30 }, { n: "üçü –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", p: 30 }, { n: "ü•í –û–≥—É—Ä—á–∏–∫", p: 20 }];

    let cart = {};

    function render() {
        const nav = document.getElementById('nav-tabs');
        const list = document.getElementById('menu-list');
        nav.innerHTML = ''; list.innerHTML = '';
        
        Object.entries(categories).forEach(([catId, catName]) => {
            nav.innerHTML += `<a href="#cat-${catId}" class="nav-btn" onclick="highlightNav(this)">${catName}</a>`;
            list.innerHTML += `<div id="cat-${catId}" class="section-anchor"><div class="category-header">${catName}</div></div>`;
            
            menuItems.filter(i => i.category === catId).forEach(item => {
                const imgStyle = item.image ? `style="background-image: url('${item.image}')"` : '';
                const addonsHTML = addonsList.map((a, idx) => `
                    <div class="addon-item">
                        <input type="checkbox" class="addon-cb" id="cb-${item.id}-${idx}" data-price="${a.p}" data-name="${a.n}" onchange="updateMainBtn()">
                        <label for="cb-${item.id}-${idx}">${a.n} (+${a.p}‚ÇΩ)</label>
                    </div>`).join('');

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ–≤ –¥–ª—è –∫–æ–º–±–æ
                let selectsHTML = '';
                if (item.selects) {
                    item.selects.forEach(sel => {
                        selectsHTML += `
                            <span class="comment-label">${sel.label}</span>
                            <select class="item-select" data-id="${sel.id}">
                                ${sel.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                            </select>
                        `;
                    });
                }

                list.innerHTML += `
                    <div class="item-card-wrapper" id="card-${item.id}">
                        <div class="item-main">
                            <div class="item-img" ${imgStyle}></div>
                            <div class="item-info">
                                <div class="item-title">${item.title}</div>
                                <div class="item-desc">${item.desc || ''}</div>
                            </div>
                            <div class="item-controls">
                                <div class="price">${item.price} ‚ÇΩ</div>
                                <button class="add-btn" id="add-${item.id}" onclick="updateCart('${item.id}', 1)">–î–æ–±–∞–≤–∏—Ç—å</button>
                                <div class="counter" id="cnt-${item.id}">
                                    <button onclick="updateCart('${item.id}', -1)">‚àí</button>
                                    <span class="count-num" id="num-${item.id}">0</span>
                                    <button onclick="updateCart('${item.id}', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="addon-section" id="addons-${item.id}">
                            ${selectsHTML}
                            <div class="addon-grid">${addonsHTML}</div>
                            <span class="comment-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –±–ª—é–¥—É:</span>
                            <textarea id="comment-${item.id}" placeholder="–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è..." rows="2"></textarea>
                        </div>
                    </div>`;
            });
        });
        if (document.querySelector('.nav-btn')) document.querySelector('.nav-btn').classList.add('active');
    }

    function highlightNav(el) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    function updateCart(id, delta) {
        cart[id] = (cart[id] || 0) + delta;
        const addBtn = document.getElementById(`add-${id}`);
        const counter = document.getElementById(`cnt-${id}`);
        const num = document.getElementById(`num-${id}`);
        const addonsBlock = document.getElementById(`addons-${id}`);

        if (cart[id] > 0) {
            addBtn.style.display = 'none'; counter.style.display = 'flex';
            num.innerText = cart[id]; addonsBlock.style.display = 'block';
        } else {
            delete cart[id];
            addBtn.style.display = 'block'; counter.style.display = 'none';
            addonsBlock.style.display = 'none';
        }
        tg.HapticFeedback.selectionChanged();
        updateMainBtn(); 
    }

    function updateMainBtn() {
        let total = 0; let hasItems = false;
        for (const id in cart) {
            const count = cart[id];
            const item = menuItems.find(i => String(i.id) === String(id));
            if (item && count > 0) {
                let itemTotal = item.price;
                const card = document.getElementById(`card-${id}`);
                card.querySelectorAll('.addon-cb:checked').forEach(cb => itemTotal += parseInt(cb.dataset.price));
                total += itemTotal * count;
                hasItems = true;
            }
        }
        if (hasItems) {
            tg.MainButton.setParams({ text: `–û–§–û–†–ú–ò–¢–¨: ${total} ‚ÇΩ`, is_visible: true });
        } else { tg.MainButton.hide(); }
    }

    function onConfirm() {
        tg.MainButton.showProgress();
        const order = []; let finalTotal = 0;

        for (const id in cart) {
            const count = cart[id];
            const item = menuItems.find(i => String(i.id) === String(id));
            if (item && count > 0) {
                const card = document.getElementById(`card-${id}`);
                const addons = Array.from(card.querySelectorAll('.addon-cb:checked')).map(cb => cb.dataset.name);
                const comment = document.getElementById(`comment-${id}`).value;
                
                // –°–±–æ—Ä –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π (–Ω–∞–ø–∏—Ç–æ–∫, —Å–æ—É—Å)
                const selectedOptions = Array.from(card.querySelectorAll('.item-select')).map(s => `${s.previousElementSibling.innerText.replace(':', '')}: ${s.value}`);
                
                let priceWithAddons = item.price;
                card.querySelectorAll('.addon-cb:checked').forEach(cb => priceWithAddons += parseInt(cb.dataset.price));
                
                finalTotal += priceWithAddons * count;
                order.push({
                    –ù–∞–∑–≤–∞–Ω–∏–µ: item.title,
                    –ö–æ–ª_–≤–æ: count,
                    –¶–µ–Ω–∞_–µ–¥: priceWithAddons,
                    –í—ã–±–æ—Ä: selectedOptions.join(' | ') || '–Ω–µ—Ç',
                    –î–æ–±–∞–≤–∫–∏: addons.join(', ') || '–Ω–µ—Ç',
                    –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: comment || '–Ω–µ—Ç'
                });
            }
        }

        tg.sendData(JSON.stringify({ –∑–∞–∫–∞–∑: order, –∏—Ç–æ–≥–æ: finalTotal, –≤—Ä–µ–º—è: "üöÄ –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ" }));
        setTimeout(() => tg.close(), 200);
    }

    tg.onEvent('mainButtonClicked', onConfirm);
    render();
</script>
</body>
</html>
