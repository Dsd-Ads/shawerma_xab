<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–∞—É—Ä–º–∞ –•–∞–±</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #248b91);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
        }

        body {
            font-family: -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
        }

        .category-header {
            padding: 20px 16px 8px; font-size: 13px; font-weight: 800;
            color: var(--button-color); text-transform: uppercase;
        }

        .item-card {
            background: var(--bg-color);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 12px 16px;
        }

        .item-main { display: flex; gap: 12px; align-items: center; }

        /* –°–¢–ò–õ–¨ –î–õ–Ø –§–û–¢–û */
        .item-img {
            width: 70px; height: 70px; border-radius: 12px;
            background-color: var(--secondary-bg);
            background-size: cover; background-position: center;
            flex-shrink: 0;
        }

        .item-info { flex: 1; }
        .item-title { font-size: 15px; font-weight: 600; }
        .item-desc { font-size: 12px; color: var(--hint-color); margin-top: 2px; }

        .price-row { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .price { font-weight: 800; font-size: 15px; }

        .add-btn {
            background-color: var(--button-color); color: var(--button-text); border: none;
            padding: 6px 14px; border-radius: 10px; font-weight: 600;
        }

        .counter {
            display: none; align-items: center; background-color: var(--button-color);
            color: var(--button-text); border-radius: 10px; padding: 2px;
        }
        .counter button { background: none; border: none; color: white; width: 30px; height: 30px; font-size: 18px; }
        .count-num { width: 20px; text-align: center; font-weight: 700; }

        .addon-section {
            display: none; margin-top: 12px; padding: 12px;
            background-color: var(--secondary-bg); border-radius: 12px;
        }

        .combo-select {
            width: 100%; padding: 8px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);
            background: var(--bg-color); color: var(--text-color); margin-bottom: 8px;
        }

        .addon-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .addon-item { display: flex; align-items: center; font-size: 12px; }
        .addon-item input { margin-right: 6px; }

        textarea {
            width: 100%; margin-top: 8px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);
            padding: 8px; font-size: 12px; background: var(--bg-color); color: var(--text-color);
            box-sizing: border-box; resize: none;
        }

        .bottom-space { height: 80px; }
    </style>
</head>
<body>

<div id="menu-list"></div>
<div class="bottom-space"></div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const listDrinks = ["–ö–æ–ª–∞ 0.5", "–ú–æ—Ä—Å", "–ß–∞–π"];
    const listSauces = ["–°—ã—Ä–Ω—ã–π", "–ß–µ—Å–Ω–æ—á–Ω—ã–π", "–ê–¥–∂–∏–∫–∞"];

    // –î–ê–ù–ù–´–ï –° –§–û–¢–û (–ó–∞–º–µ–Ω–∏—Ç–µ URL –Ω–∞ —Å–≤–æ–∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏)
    const menuData = [
        {
            category: "üéÅ –ö–æ–º–±–æ",
            items: [
                { id: "c1", name: "–ö–æ–º–±–æ 1", price: 450, desc: "–•–æ—Ç-–¥–æ–≥, —Ñ—Ä–∏, —Å–æ—É—Å, –Ω–∞–ø–∏—Ç–æ–∫", img: "https://cdn-icons-png.flaticon.com/512/737/737602.png", opts: [{l: "–ù–∞–ø–∏—Ç–æ–∫", d: listDrinks}, {l: "–°–æ—É—Å", d: listSauces}] },
                { id: "c2", name: "–ö–æ–º–±–æ 2", price: 550, desc: "–ë–ª—ç–∫ –±—É—Ä–≥–µ—Ä, —Ö–∞—à–±—Ä–∞—É–Ω, –Ω–∞–ø–∏—Ç–æ–∫", img: "https://cdn-icons-png.flaticon.com/512/877/877951.png", opts: [{l: "–ù–∞–ø–∏—Ç–æ–∫", d: listDrinks}] }
            ]
        },
        {
            category: "üåØ –®–∞—É—Ä–º–∞",
            items: [
                { id: "sh_kur", name: "–®–∞—É—Ä–º–∞ –∫—É—Ä–∏—Ü–∞ (–°—Ç)", price: 290, desc: "390–≥. –û–≤–æ—â–∏, —Å–æ—É—Å—ã", img: "https://cdn-icons-png.flaticon.com/512/575/575454.png" }
            ]
        }
    ];

    const addons = [{ n: "üßÄ –°—ã—Ä", p: 40 }, { n: "üî• –•–∞–ª–∞–ø–µ–Ω—å–æ", p: 30 }];
    let cart = {};

    function render() {
        const list = document.getElementById('menu-list');
        menuData.forEach(cat => {
            const h = document.createElement('div');
            h.className = 'category-header'; h.innerText = cat.category;
            list.appendChild(h);

            cat.items.forEach(item => {
                const optsHTML = item.opts ? item.opts.map(o => `
                    <label style="font-size:10px; font-weight:bold; color:gray;">${o.l.toUpperCase()}</label>
                    <select class="combo-select" onchange="recalc()">
                        ${o.d.map(v => `<option value="${v}">${v}</option>`).join('')}
                    </select>
                `).join('') : '';

                const div = document.createElement('div');
                div.className = 'item-card';
                div.id = `item-${item.id}`;
                div.innerHTML = `
                    <div class="item-main">
                        <div class="item-img" style="background-image: url('${item.img}')"></div>
                        <div class="item-info">
                            <div class="item-title">${item.name}</div>
                            <div class="item-desc">${item.desc}</div>
                            <div class="price-row">
                                <div class="price">${item.price} ‚ÇΩ</div>
                                <button class="add-btn" id="add-${item.id}" onclick="changeQty('${item.id}', 1, ${item.price})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                                <div class="counter" id="cnt-${item.id}">
                                    <button onclick="changeQty('${item.id}', -1, ${item.price})">‚àí</button>
                                    <span class="count-num" id="q-${item.id}">0</span>
                                    <button onclick="changeQty('${item.id}', 1, ${item.price})">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="addon-section" id="a-${item.id}">
                        ${optsHTML}
                        <div class="addon-grid">
                            ${addons.map((a, i) => `
                                <div class="addon-item">
                                    <input type="checkbox" class="cb" data-p="${a.p}" data-n="${a.n}" onchange="recalc()">
                                    <span>${a.n} (+${a.p}‚ÇΩ)</span>
                                </div>`).join('')}
                        </div>
                        <textarea id="c-${item.id}" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." oninput="recalc()"></textarea>
                    </div>
                `;
                list.appendChild(div);
            });
        });
    }

    window.changeQty = function(id, delta, price) {
        if (!cart[id]) cart[id] = { q: 0, p: price };
        cart[id].q += delta;
        if (cart[id].q < 0) cart[id].q = 0;

        document.getElementById(`q-${id}`).innerText = cart[id].q;
        document.getElementById(`add-${id}`).style.display = cart[id].q > 0 ? 'none' : 'block';
        document.getElementById(`cnt-${id}`).style.display = cart[id].q > 0 ? 'flex' : 'none';
        document.getElementById(`a-${id}`).style.display = cart[id].q > 0 ? 'block' : 'none';

        if (cart[id].q === 0) delete cart[id];
        recalc();
    };

    window.recalc = function() {
        let total = 0;
        let orderList = [];

        for (const id in cart) {
            const card = document.getElementById(`item-${id}`);
            let finalPrice = cart[id].p;
            let subDetails = [];

            card.querySelectorAll('.combo-select').forEach(s => subDetails.push(s.value));
            card.querySelectorAll('.cb:checked').forEach(c => {
                finalPrice += parseInt(c.dataset.p);
                subDetails.push(c.dataset.n);
            });

            const comment = document.getElementById(`c-${id}`).value;

            total += finalPrice * cart[id].q;
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–Ω—è—Ç–Ω—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –±–æ—Ç–∞
            orderList.push({
                "–Ω–∞–∑–≤–∞–Ω–∏–µ": card.querySelector('.item-title').innerText,
                "–∫–æ–ª_–≤–æ": cart[id].q,
                "—Ü–µ–Ω–∞": finalPrice,
                "–≤—ã–±–æ—Ä": subDetails.join(', ') || "—Å—Ç–∞–Ω–¥–∞—Ä—Ç",
                "–∫–æ–º–º–µ–Ω—Ç": comment || "-"
            });
        }

        if (total > 0) {
            tg.MainButton.setParams({ text: `–û–§–û–†–ú–ò–¢–¨: ${total} ‚ÇΩ`, is_visible: true });
        } else {
            tg.MainButton.hide();
        }

        tg.MainButton.offClick(sendOrder);
        tg.MainButton.onClick(sendOrder);

        function sendOrder() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º JSON-—Å—Ç—Ä–æ–∫—É. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –µ—ë –ø—Ä–∏–Ω—è—Ç—å.
            tg.sendData(JSON.stringify({ "–∑–∞–∫–∞–∑": orderList, "–∏—Ç–æ–≥–æ": total }));
        }
    };

    render();
</script>
</body>
</html>
