<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö—Ä–∞—Ñ—Ç –•–∞–± ‚Äî –ú–µ–Ω—é</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #248bed);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
        }

        body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; }
        
        header { position: sticky; top: 0; background: var(--bg-color); z-index: 10; padding: 10px; border-bottom: 0.5px solid #eee; text-align: center; font-weight: bold; }
        
        .nav-tabs { display: flex; overflow-x: auto; padding: 10px; gap: 8px; position: sticky; top: 41px; background: var(--bg-color); z-index: 9; border-bottom: 0.5px solid #eee; }
        .nav-btn { padding: 6px 15px; background: var(--secondary-bg); border-radius: 15px; font-size: 13px; white-space: nowrap; text-decoration: none; color: inherit; border: none; }
        .nav-btn.active { background: var(--button-color); color: var(--button-text); }

        .item-card { display: flex; padding: 15px; border-bottom: 0.5px solid #f0f0f0; gap: 12px; align-items: center; }
        .item-img { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; background: #f5f5f5; }
        .item-info { flex: 1; }
        .item-title { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .item-desc { font-size: 12px; color: var(--hint-color); line-height: 1.2; }
        .item-price { font-weight: 700; color: var(--text-color); margin-top: 8px; }

        .add-btn { background: var(--button-color); color: var(--button-text); border: none; padding: 8px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        #modal-overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: flex-end; }
        #modal { background: var(--bg-color); width: 100%; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; max-height: 85vh; overflow-y: auto; }
        
        .mod-section-title { font-size: 14px; font-weight: bold; color: var(--hint-color); margin: 15px 0 10px; text-transform: uppercase; }
        .modifier-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; align-items: center; }
        .modifier-item input { width: 22px; height: 22px; accent-color: var(--button-color); }

        .category-title { padding: 15px 15px 5px; font-weight: bold; color: var(--hint-color); text-transform: uppercase; font-size: 12px; }
        .bottom-space { height: 100px; }
    </style>
</head>
<body>

<header>–ö–†–ê–§–¢ –•–ê–ë</header>
<div class="nav-tabs" id="nav-tabs"></div>
<div id="menu-container"></div>
<div class="bottom-space"></div>

<div id="modal-overlay">
    <div id="modal">
        <h3 id="modal-title" style="margin-top:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</h3>
        <div id="modifiers-content"></div>
        <button class="add-btn" style="width: 100%; margin-top: 20px; padding: 16px;" onclick="confirmAdd()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑</button>
        <button onclick="closeModal()" style="width: 100%; background: none; border: none; padding: 15px; color: var(--hint-color);">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ë–ê–ó–ê –î–ê–ù–ù–´–• –ú–û–î–ò–§–ò–ö–ê–¢–û–†–û–í
    const modDB = {
        sauces: {
            title: "–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—É—Å",
            items: [
                { id: "s1", title: "–°—ã—Ä–Ω—ã–π —Å–æ—É—Å", price: 0 },
                { id: "s2", title: "–ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å", price: 0 },
                { id: "s3", title: "–ë–∞—Ä–±–µ–∫—é", price: 0 },
                { id: "s4", title: "–ö–µ—Ç—á—É–ø", price: 0 }
            ]
        },
        drinks: {
            title: "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø–∏—Ç–æ–∫",
            items: [
                { id: "d1", title: "–ö–æ–ª–∞ 0.33", price: 0 },
                { id: "d2", title: "–ê–ø–µ–ª—å—Å–∏–Ω 0.33", price: 0 },
                { id: "d3", title: "–°–æ–∫ —è–±–ª–æ–∫–æ", price: 0 },
                { id: "d4", title: "–í–æ–¥–∞ –≥–∞–∑.", price: 0 }
            ]
        },
        shaurma_extra: {
            title: "–î–æ–±–∞–≤–∫–∏",
            items: [
                { id: "e1", title: "–î–≤–æ–π–Ω–æ–π —Å—ã—Ä", price: 40 },
                { id: "e2", title: "–•–∞–ª–∞–ø–µ–Ω—å–æ", price: 30 },
                { id: "e3", title: "–î–æ–ø. –º—è—Å–æ", price: 100 }
            ]
        }
    };

    // –ú–ï–ù–Æ
    const menu = [
        { 
            cat: "üç± –ö–æ–º–±–æ-–æ–±–µ–¥—ã", 
            items: [
                { 
                    id: "c1", title: "–ö–æ–º–±–æ ‚Ññ1 (—Å —Å–æ—É—Å–æ–º)", price: 500, 
                    desc: "–•–æ—Ç-–¥–æ–≥, —Ñ—Ä–∏, –Ω–∞–ø–∏—Ç–æ–∫ –∏ —Å–æ—É—Å", 
                    img: "https://placehold.co/200x200?text=Combo1",
                    requiredMods: ["drinks", "sauces"] // –ò –Ω–∞–ø–∏—Ç–æ–∫, –∏ —Å–æ—É—Å
                },
                { 
                    id: "c2", title: "–ö–æ–º–±–æ ‚Ññ2 (–±–µ–∑ —Å–æ—É—Å–∞)", price: 550, 
                    desc: "–ë–ª—ç–∫ –±—É—Ä–≥–µ—Ä, —Ö–∞—à–±—Ä–∞—É–Ω, –Ω–∞–ø–∏—Ç–æ–∫", 
                    img: "https://placehold.co/200x200?text=Combo2",
                    requiredMods: ["drinks"] // –¢–æ–ª—å–∫–æ –Ω–∞–ø–∏—Ç–æ–∫
                }
            ]
        },
        { 
            cat: "üåØ –®–∞—É—Ä–º–∞", 
            items: [
                { 
                    id: "sh1", title: "–®–∞—É—Ä–º–∞ –ö—É—Ä–∏–Ω–∞—è", price: 290, 
                    desc: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —à–∞—É—Ä–º–∞ 390–≥", 
                    img: "https://placehold.co/200x200?text=Shaurma",
                    requiredMods: ["shaurma_extra"] 
                }
            ]
        }
    ];

    let cart = [];
    let currentItem = null;

    function renderMenu() {
        const container = document.getElementById('menu-container');
        const nav = document.getElementById('nav-tabs');
        
        menu.forEach((section, idx) => {
            const catId = `cat-${idx}`;
            nav.innerHTML += `<button class="nav-btn ${idx===0?'active':''}" onclick="scrollToCat('${catId}', this)">${section.cat}</button>`;
            container.innerHTML += `<div class="category-title" id="${catId}">${section.cat}</div>`;
            
            section.items.forEach(item => {
                container.innerHTML += `
                    <div class="item-card">
                        <img class="item-img" src="${item.img}">
                        <div class="item-info">
                            <div class="item-title">${item.title}</div>
                            <div class="item-desc">${item.desc}</div>
                            <div class="item-price">${item.price} ‚ÇΩ</div>
                        </div>
                        <button class="add-btn" onclick="openModal('${item.id}')">Ôºã</button>
                    </div>
                `;
            });
        });
    }

    function scrollToCat(id, btn) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function openModal(itemId) {
        let item;
        menu.forEach(c => { const found = c.items.find(i => i.id === itemId); if(found) item = found; });
        currentItem = JSON.parse(JSON.stringify(item));
        
        const content = document.getElementById('modifiers-content');
        content.innerHTML = '';
        document.getElementById('modal-title').innerText = item.title;

        if (item.requiredMods) {
            item.requiredMods.forEach(modKey => {
                const group = modDB[modKey];
                content.innerHTML += `<div class="mod-section-title">${group.title}</div>`;
                group.items.forEach(m => {
                    const isRadio = (modKey === 'drinks' || modKey === 'sauces');
                    content.innerHTML += `
                        <label class="modifier-item">
                            <span>${m.title} ${m.price > 0 ? '(+' + m.price + ' ‚ÇΩ)' : ''}</span>
                            <input type="${isRadio ? 'radio' : 'checkbox'}" 
                                   name="${modKey}" 
                                   data-title="${m.title}" 
                                   data-price="${m.price}">
                        </label>
                    `;
                });
            });
        }

        document.getElementById('modal-overlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function confirmAdd() {
        const selectedMods = [];
        let extraPrice = 0;
        
        document.querySelectorAll('#modifiers-content input:checked').forEach(input => {
            selectedMods.push(input.dataset.title);
            extraPrice += parseInt(input.dataset.price);
        });

        cart.push({
            title: currentItem.title,
            mods: selectedMods,
            totalPrice: currentItem.price + extraPrice
        });

        tg.HapticFeedback.impactOccurred('medium');
        closeModal();
        updateMainButton();
    }

    function updateMainButton() {
        const total = cart.reduce((sum, i) => sum + i.totalPrice, 0);
        if (total > 0) {
            tg.MainButton.setText(`–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó: ${total} ‚ÇΩ`);
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

    tg.onEvent('mainButtonClicked', () => {
        tg.sendData(JSON.stringify(cart));
    });

    renderMenu();
</script>
</body>
</html>
