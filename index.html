<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–®–∞—É—Ä–º–∞ –•–∞–±</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-button-color: #248b91;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f5f5f5;
        }
        body { font-family: sans-serif; background: var(--tg-theme-bg-color); margin: 0; padding: 10px; padding-bottom: 100px; }
        .category { font-weight: bold; text-transform: uppercase; color: var(--tg-theme-button-color); margin: 20px 0 10px; border-bottom: 2px solid; }
        .item-card { background: var(--tg-theme-secondary-bg-color); border-radius: 12px; padding: 12px; margin-bottom: 10px; }
        .item-header { display: flex; justify-content: space-between; font-weight: bold; }
        .controls { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .btn-qty { background: var(--tg-theme-button-color); color: white; border: none; border-radius: 6px; width: 35px; height: 35px; font-size: 1.2rem; cursor: pointer; }
        .addon-block { display: none; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd; }
        .addons-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.8rem; }
        textarea { width: 100%; box-sizing: border-box; margin-top: 8px; border-radius: 8px; border: 1px solid #ccc; padding: 8px; font-family: inherit; }
    </style>
</head>
<body>

<div id="menu-container"></div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const menuData = [
        {
            category: "üåØ –®–∞—É—Ä–º–∞",
            items: [
                { id: "sh_kur_st", name: "–®–∞—É—Ä–º–∞ –ö—É—Ä–∏—Ü–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)", price: 290 },
                { id: "sh_kur_big", name: "–®–∞—É—Ä–º–∞ –ö—É—Ä–∏—Ü–∞ (–ë–æ–ª—å—à–∞—è)", price: 350 },
                { id: "sh_svin_st", name: "–®–∞—É—Ä–º–∞ –°–≤–∏–Ω–∏–Ω–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)", price: 320 },
                { id: "sh_svin_big", name: "–®–∞—É—Ä–º–∞ –°–≤–∏–Ω–∏–Ω–∞ (–ë–æ–ª—å—à–∞—è)", price: 380 },
                { id: "sh_hub", name: "üåü –®–∞—É—Ä–º–∞ –•–ê–ë", price: 390 },
                { id: "sh_fish", name: "üêü –®–∞—É—Ä–º–∞ –°–∫—É–º–±—Ä–∏—è", price: 340 }
            ]
        },
        {
            category: "üéÅ –ö–æ–º–±–æ –û–±–µ–¥—ã",
            items: [
                { id: "c1", name: "–ö–æ–º–±–æ ‚Ññ1 (–•–æ—Ç-–¥–æ–≥)", price: 500 },
                { id: "c2", name: "–ö–æ–º–±–æ ‚Ññ2 (–ë—É—Ä–≥–µ—Ä)", price: 550 },
                { id: "c3", name: "–ö–æ–º–±–æ ‚Ññ3 (–®–∞—É—Ä–º–∞)", price: 520 }
            ]
        }
        // –î–æ–±–∞–≤—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ –∑–¥–µ—Å—å
    ];

    const addons = [
        { n: "üßÄ –°—ã—Ä", p: 40 },
        { n: "üî• –•–∞–ª–∞–ø–µ–Ω—å–æ", p: 30 },
        { n: "üçü –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", p: 30 },
        { n: "ü•í –û–≥—É—Ä–µ—Ü –º–∞—Ä.", p: 20 }
    ];

    let cart = {};

    function renderMenu() {
        const container = document.getElementById('menu-container');
        menuData.forEach(cat => {
            const h = document.createElement('div');
            h.className = 'category';
            h.innerText = cat.category;
            container.appendChild(h);

            cat.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item-card';
                div.dataset.id = item.id;
                div.innerHTML = `
                    <div class="item-header"><span>${item.name}</span><span>${item.price}‚ÇΩ</span></div>
                    <div class="controls">
                        <div class="qty-box">
                            <button class="btn-qty" onclick="updateQty('${item.id}', -1, ${item.price})">-</button>
                            <span style="margin: 0 10px; font-weight:bold;" id="q-${item.id}">0</span>
                            <button class="btn-qty" onclick="updateQty('${item.id}', 1, ${item.price})">+</button>
                        </div>
                    </div>
                    <div class="addon-block" id="ab-${item.id}">
                        <div class="addons-grid">
                            ${addons.map(a => `<label><input type="checkbox" class="cb" data-n="${a.n}" data-p="${a.p}" onchange="calc()"> ${a.n}</label>`).join('')}
                        </div>
                        <textarea placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    function updateQty(id, delta, price) {
        if (!cart[id]) {
            const el = document.querySelector(`[data-id="${id}"]`);
            cart[id] = { qty: 0, name: el.querySelector('.item-header span').innerText, price: price };
        }
        cart[id].qty += delta;
        if (cart[id].qty < 0) cart[id].qty = 0;
        
        document.getElementById(`q-${id}`).innerText = cart[id].qty;
        document.getElementById(`ab-${id}`).style.display = cart[id].qty > 0 ? 'block' : 'none';
        calc();
    }

    function calc() {
        let total = 0;
        let count = 0;
        for (let id in cart) {
            if (cart[id].qty > 0) {
                total += cart[id].qty * cart[id].price;
                const card = document.querySelector(`[data-id="${id}"]`);
                card.querySelectorAll('.cb:checked').forEach(cb => total += parseInt(cb.dataset.p));
                count++;
            }
        }
        
        if (count > 0) {
            tg.MainButton.setText(`–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó (${total}‚ÇΩ)`);
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

    // –ì–õ–ê–í–ù–û–ï: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
    tg.onEvent('mainButtonClicked', function() {
        try {
            let order = [];
            for (let id in cart) {
                if (cart[id].qty > 0) {
                    const card = document.querySelector(`[data-id="${id}"]`);
                    order.push({
                        name: cart[id].name,
                        qty: cart[id].qty,
                        addons: Array.from(card.querySelectorAll('.cb:checked')).map(cb => cb.dataset.n),
                        comment: card.querySelector('textarea').value
                    });
                }
            }

            if (order.length > 0) {
                const data = JSON.stringify(order);
                tg.sendData(data); // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
            } else {
                tg.showAlert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");
            }
        } catch (error) {
            tg.showAlert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ: " + error.message);
        }
    });

    renderMenu();
</script>
</body>
</html>
